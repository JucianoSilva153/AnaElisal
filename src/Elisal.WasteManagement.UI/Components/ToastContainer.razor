@using Elisal.WasteManagement.UI.Services
@inject NotificationService NotificationService
@implements IDisposable

<div class="fixed top-4 right-4 z-[9999] flex flex-col gap-3 pointer-events-none">
    @foreach (var toast in toasts)
    {
        <div class="pointer-events-auto min-w-[300px] max-w-md animate-slide-in @GetColorClass(toast.Type) p-4 rounded-xl shadow-lg border flex gap-3 items-start">
            <span class="material-symbols-outlined @GetIconColor(toast.Type)">@GetIcon(toast.Type)</span>
            <div class="flex-1">
                <p class="text-sm font-medium">@toast.Message</p>
            </div>
            <button @onclick="() => RemoveToast(toast)" class="text-slate-400 hover:text-slate-600">
                <span class="material-symbols-outlined text-sm">close</span>
            </button>
        </div>
    }
</div>

@code {
    private List<ToastModel> toasts = new();

    protected override void OnInitialized()
    {
        NotificationService.OnShow += HandleShow;
    }

    private void HandleShow(string message, NotificationType type)
    {
        var toast = new ToastModel { Message = message, Type = type };
        toasts.Add(toast);
        StateHasChanged();

        Task.Delay(5000).ContinueWith(_ => RemoveToast(toast));
    }

    private void RemoveToast(ToastModel toast)
    {
        toasts.Remove(toast);
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        NotificationService.OnShow -= HandleShow;
    }

    private string GetColorClass(NotificationType type) => type switch
    {
        NotificationType.Success => "bg-white dark:bg-slate-900 border-green-100 dark:border-green-900/30 text-slate-800 dark:text-white",
        NotificationType.Error => "bg-white dark:bg-slate-900 border-red-100 dark:border-red-900/30 text-slate-800 dark:text-white",
        NotificationType.Warning => "bg-white dark:bg-slate-900 border-yellow-100 dark:border-yellow-900/30 text-slate-800 dark:text-white",
        _ => "bg-white dark:bg-slate-900 border-blue-100 dark:border-blue-900/30 text-slate-800 dark:text-white"
    };

    private string GetIcon(NotificationType type) => type switch
    {
        NotificationType.Success => "check_circle",
        NotificationType.Error => "error",
        NotificationType.Warning => "warning",
        _ => "info"
    };

    private string GetIconColor(NotificationType type) => type switch
    {
        NotificationType.Success => "text-green-500",
        NotificationType.Error => "text-red-500",
        NotificationType.Warning => "text-yellow-500",
        _ => "text-blue-500"
    };

    private class ToastModel
    {
        public string Message { get; set; } = "";
        public NotificationType Type { get; set; }
    }
}

<style>
    @@keyframes slide-in {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    .animate-slide-in {
        animation: slide-in 0.3s ease-out forwards;
    }
</style>
